(async function(){const q=new URLSearchParams(location.search);const regionId=q.get('region');async function loadJSON(p){const r=await fetch(p,{cache:'no-store'});if(!r.ok)throw new Error('Failed '+p);return await r.json();}
const regionsGrid=document.querySelector('#regions');if(regionsGrid){const d=await loadJSON('./data/regions.json');regionsGrid.innerHTML=d.regions.map(r=>`<a class="region-card" href="./region.html?region=${r.id}"><img src="${r.emblem}" alt="${r.name}"/><h3>${r.name}</h3></a>`).join('');const homePartners=document.querySelector('#homePartners');if(homePartners){homePartners.innerHTML=[{"name":"الراعي البلاتيني","logo":"./assets/partners/sponsorA.png"},{"name":"الراعي الذهبي","logo":"./assets/partners/sponsorB.png"},{"name":"الراعي الفضي","logo":"./assets/partners/sponsorC.png"}].map(p=>`<span class="partner" title="${p.name}"><img src="${p.logo}" alt="${p.name}"></span>`).join('');}return;}
if(!regionId)return;const list=await loadJSON('./data/regions.json');const meta=list.regions.find(r=>r.id===regionId);const d=await loadJSON(`./data/${regionId}.json`);document.title=d.title||'ملتقى تلبية - منطقة';const hero=document.querySelector('#regionHero');if(hero&&meta){hero.innerHTML=`<img class="emblem" src="${meta.emblem}" alt="${meta.name}"/><div><h1>${meta.name}</h1><p>${d.overview||''}</p></div>`;}const overview=document.querySelector('#overview');if(overview){overview.innerHTML=`<h2>نظرة عامة</h2><p>${d.overview||''}</p>`;}const axisPills=document.querySelector('#axisPills');if(axisPills&&Array.isArray(d.axes)){axisPills.innerHTML=d.axes.map(ax=>`<button class="pill" data-axis="${ax}">${ax}</button>`).join('');}const filter=document.querySelector('#axisFilter');const cards=document.querySelector('#speakerCards');function render(axis=null){const list=(d.speakers||[]).filter(s=>!axis||s.axis===axis||s.short_axis===axis);cards.innerHTML=list.map(s=>`<article class="speaker-card"><img src="${s.photo}" alt="${s.name}"/><div class="speaker-body"><h3>${s.name}</h3><p class="role">${s.role||''}</p><p class="bio">${s.bio||''}</p>${s.short_axis?`<span class="badge">${s.short_axis}</span>`:''}</div></article>`).join('');}
if(filter&&Array.isArray(d.axes)){filter.innerHTML=`<button class="pill active" data-axis="">الكل</button>`+d.axes.map(ax=>`<button class="pill" data-axis="${ax}">${ax}</button>`).join('');filter.addEventListener('click',e=>{const b=e.target.closest('button.pill');if(!b)return;[...filter.querySelectorAll('.pill')].forEach(x=>x.classList.remove('active'));b.classList.add('active');render(b.dataset.axis||null);});}
render();const partners=document.querySelector('#regionPartners');if(partners&&Array.isArray(d.partners)){partners.innerHTML=d.partners.map(p=>`<span class="partner" title="${p.name}"><img src="${p.logo}" alt="${p.name}"></span>`).join('');}
const venue=document.querySelector('#venue');if(venue&&d.venue){venue.innerHTML=`<h2>المقر</h2><p><strong>${d.venue.name||''}</strong></p><p>${d.venue.dates||''}</p>${d.venue.map?`<p><a class="btn" href="${d.venue.map}" target="_blank" rel="noopener">الموقع على الخريطة</a></p>`:''}${d.venue.note?`<p class="note">${d.venue.note}</p>`:''}`;}
const faq=document.querySelector('#faq');if(faq&&Array.isArray(d.faq)){faq.innerHTML=d.faq.map(i=>`<details><summary>${i.q}</summary><p>${i.a}</p></details>`).join('');}
const reg=document.querySelector('#regButton');if(reg&&d.registerUrl)reg.href=d.registerUrl;})();